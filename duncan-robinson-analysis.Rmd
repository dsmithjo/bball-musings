---
title: 
output: html_document
---

# A first cut at Duncan Robinson's impact on the Miami Heat's record

***

<br>

### The big question
Is there a relationship between whether Duncan Robinson plays and whether Miami wins or loses games?

<br>

### Methods
To test this relationship, Duncan Robinson's game logs (whether he played or not) and the outcomes of all Heat contests over his career are analyzed using a Chi-square test for independence. All data are from NBA Reference.

<br>

### Results

```{r wrangle, include=FALSE}

# LOAD packages --------------------

xfun::pkg_attach("tidyverse", "janitor", "data.table", "gt", "flextable", message = FALSE)


# IMPORT and TIDY data --------------------

# data: Duncan Robinson's game logs, regular season and post-season
# data source: CSVs via GitHub
# abbreviated data cleaning steps shown

# import regular season and tidy data
gl_reg <- fread('https://raw.githubusercontent.com/dsmithjo/bball-musings/main/data/duncan-robinson-game-logs-reg-season-to-20230429.csv') %>%
  clean_names() %>%
  separate(v8, c("game_outcome", "pt_diff"), " \\(") %>%
  rename(game_num = "rk") %>%
  mutate(season_type = "regular",
         duncan_outcome = case_when(
           mp ==  "Did Not Dress" ~ "did not play",
           mp ==  "Did Not Play" ~ "did not play",
           mp == "Inactive" ~ "did not play",
           TRUE ~ "played"
         ),
         season = case_when(
           date >= "2018-10-17" & date <= "2019-04-10" ~ "2018-19",
           date >= "2019-10-23" & date <= "2020-08-14" ~ "2019-20",
           date >= "2020-12-23" & date <= "2021-05-16" ~ "2020-21",
           date >= "2021-10-21" & date <= "2022-04-10" ~ "2021-22",
           date >= "2022-10-19" & date <= "2023-04-09" ~ "2022-23"
         ),
         game_outcome = case_when(
           game_outcome == "W" ~ "win",
           TRUE ~ "loss"
         )) %>%
  select(season, season_type, game_num, date, duncan_outcome, game_outcome)

# import post-season and tidy data
gl_post <- fread('https://raw.githubusercontent.com/dsmithjo/bball-musings/main/data/duncan-robinson-game-logs-post-season-to-20230429.csv') %>%
  clean_names() %>%
  separate(v9, c("game_outcome", "pt_diff"), " \\(") %>%
  rename(game_num = g,
         date = x2020_playoffs) %>%
  mutate(season_type = "post",
         duncan_outcome = case_when(
           mp ==  "Did Not Play" ~ "did not play",
           TRUE ~ "played"
         ),
         season = case_when(
           date >= "2020-08-18" & date <= "2020-10-11" ~ "2019-20",
           date >= "2021-05-22" & date <= "2021-05-29" ~ "2020-21",
           date >= "2022-04-17" & date <= "2022-05-29" ~ "2021-22",
           date >= "2023-04-16" & date <= "2023-04-26" ~ "2022-23"
         ),
         game_outcome = case_when(
           game_outcome == "W" ~ "win",
           TRUE ~ "loss"
         )) %>%
  select(season, season_type, game_num, date, duncan_outcome, game_outcome)

# Counts:
# MIA games since Duncan's first season: 439 
# Regular season: 391
# Post-season: 48


# join data sets
gl_all <- gl_reg %>%
  full_join(gl_post)

```

#### Table 1. Crosstabulation of Duncan Robinson's status and the Heat's wins and losses

```{r analysis -- crosstab, echo=FALSE}

# ANALYZE data --------------------

# crosstab for chi0square
tab1 <- gl_all %>%
   tabyl(duncan_outcome, game_outcome)

# crosstab to display
tab2 <- gl_all %>%
   rename(`Duncan's status` = duncan_outcome) %>%
   tabyl(`Duncan's status`, game_outcome) %>%
   adorn_totals(c("col", "row"), name = "Total games") # %>%
#   adorn_title(row_name = "Duncan's status", col_name = "Game outcomes") 

(tab3 <- tab2 %>% 
    gt() %>%
    cols_label(
    loss = "Losses",
    win = "Wins"))
```

<br>
<br>

#### Table 2. Chi-square test results

```{r analysis -- chi-square, echo=FALSE}

# ANALYZE data --------------------

# chi-square test
(chi <- chisq.test(tab1, correct=FALSE) %>%
  as_flextable())
```

<br>

### Conclusion
There is *no evidence* to suggest that Duncan Robinson playing is related to the Heat winning or losing games.